<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Heritage · Simple</title>
    
    <!-- A-Frame - Latest version -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; }
        
        #esp-cursor {
            position: fixed;
            width: 40px;
            height: 40px;
            background: rgba(255,0,0,0.7);
            border: 3px solid white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            display: none;
            box-shadow: 0 0 20px red;
        }
        
        #status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: black;
            color: #4ECDC4;
            padding: 8px 16px;
            border-radius: 20px;
            z-index: 1000;
            font-family: Arial;
        }
    </style>
</head>
<body>
    <div id="esp-cursor"></div>
    <div id="status">ESP32: <span id="esp-status">○</span></div>
    
    <!-- Simple A-Frame scene -->
    <a-scene vr-mode-ui="enabled: true" background="color: #111">
        
        <!-- Camera -->
        <a-entity camera look-controls position="0 1.6 0"></a-entity>
        
        <!-- Title -->
        <a-text value="HISTORICAL SITES" 
               position="0 2.5 -4" 
               color="#FF6B6B" 
               align="center"></a-text>
        
        <!-- Menu - Simple boxes -->
        <a-box color="#FF6B6B" position="-2 1 -3" width="0.8" height="0.8" depth="0.2"
               class="menu" data-name="Battle of Quinga"></a-box>
        <a-text value="1" position="-2 0.5 -3" color="white" align="center"></a-text>
        
        <a-box color="#4ECDC4" position="-1 1 -3" width="0.8" height="0.8" depth="0.2"
               class="menu" data-name="Hiyas ng Bulacan"></a-box>
        <a-text value="2" position="-1 0.5 -3" color="white" align="center"></a-text>
        
        <a-box color="#FFD700" position="0 1 -3" width="0.8" height="0.8" depth="0.2"
               class="menu" data-name="Del Pilar Shrine"></a-box>
        <a-text value="3" position="0 0.5 -3" color="white" align="center"></a-text>
        
        <a-box color="#FF8E53" position="1 1 -3" width="0.8" height="0.8" depth="0.2"
               class="menu" data-name="Barasoain Museum"></a-box>
        <a-text value="4" position="1 0.5 -3" color="white" align="center"></a-text>
        
        <a-box color="#9B59B6" position="2 1 -3" width="0.8" height="0.8" depth="0.2"
               class="menu" data-name="Casa Real"></a-box>
        <a-text value="5" position="2 0.5 -3" color="white" align="center"></a-text>
        
        <!-- Floor -->
        <a-grid position="0 -0.5 -3" width="8" height="8" color="#4ECDC4" opacity="0.3"></a-grid>
        
        <!-- Lights -->
        <a-light type="ambient" intensity="1.2"></a-light>
        <a-light type="directional" position="2 4 3"></a-light>
    </a-scene>
    
    <script>
        const ESP32_IP = "192.168.1.10";
        let socket;
        let espConnected = false;
        
        const cursor = document.getElementById('esp-cursor');
        const espStatus = document.getElementById('esp-status');
        
        // Connect to ESP32
        function connect() {
            try {
                socket = new WebSocket("ws://" + ESP32_IP + ":81");
                
                socket.onopen = () => {
                    console.log("ESP32 Connected");
                    cursor.style.display = 'block';
                    espConnected = true;
                    espStatus.innerHTML = '●';
                    espStatus.style.color = '#4ECDC4';
                };
                
                socket.onmessage = (event) => {
                    const parts = event.data.split(',');
                    if (parts.length >= 2) {
                        const x = (parseInt(parts[0]) / 320) * window.innerWidth;
                        const y = (parseInt(parts[1]) / 240) * window.innerHeight;
                        
                        cursor.style.left = x + 'px';
                        cursor.style.top = y + 'px';
                        
                        // Check hover
                        checkHover(x, y);
                    }
                };
                
                socket.onclose = () => {
                    espStatus.innerHTML = '○';
                    espStatus.style.color = '#FF6B6B';
                    espConnected = false;
                    setTimeout(connect, 3000);
                };
            } catch(e) {
                setTimeout(connect, 3000);
            }
        }
        
        // Hover detection
        let hoverTimer;
        
        function checkHover(x, y) {
            cursor.style.display = 'none';
            const elem = document.elementFromPoint(x, y);
            cursor.style.display = 'block';
            
            let target = elem;
            while (target && !target.classList?.contains('menu')) {
                target = target.parentElement;
            }
            
            if (!target) {
                cursor.style.borderColor = 'white';
                if (hoverTimer) clearTimeout(hoverTimer);
                return;
            }
            
            cursor.style.borderColor = 'yellow';
            
            if (hoverTimer) clearTimeout(hoverTimer);
            hoverTimer = setTimeout(() => {
                const name = target.getAttribute('data-name');
                if (name) alert("Selected: " + name);
            }, 1000);
        }
        
        // Start
        window.onload = () => {
            setTimeout(connect, 2000);
        };
    </script>
</body>
</html>